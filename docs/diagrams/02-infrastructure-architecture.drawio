<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2024-12-19T12:00:00.000Z" agent="5.0" etag="example" version="24.0.0">
  <diagram name="Infrastructure Architecture" id="infrastructure-architecture">
    <mxGraphModel dx="1422" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Azure Communication Services Email MCP Tool - Infrastructure Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=18;fontColor=#0078D4;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="700" height="30" as="geometry" />
        </mxCell>
        
        <!-- Azure Subscription -->
        <mxCell id="subscription" value="Azure Subscription" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F0F8FF;strokeColor=#0078D4;strokeWidth=3;fontStyle=1;fontSize=16;fontColor=#0078D4;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="50" y="70" width="1300" height="800" as="geometry" />
        </mxCell>
        
        <!-- Resource Group -->
        <mxCell id="resource-group" value="Resource Group: rg-{environmentName}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6F3FF;strokeColor=#0078D4;strokeWidth=2;fontStyle=1;fontSize=14;fontColor=#0078D4;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="80" y="110" width="1240" height="740" as="geometry" />
        </mxCell>
        
        <!-- Compute Section -->
        <mxCell id="compute-section" value="Compute &amp; API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8DC;strokeColor=#FFB366;strokeWidth=2;fontStyle=1;fontSize=12;fontColor=#D2691E;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="110" y="150" width="380" height="320" as="geometry" />
        </mxCell>
        
        <!-- Azure Functions -->
        <mxCell id="functions" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/compute/Function_Apps.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="140" y="190" width="68" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="functions-label" value="Azure Functions&#xa;func-acsemailmcpsrv-{token}&#xa;Flex Consumption Plan&#xa;.NET 8 Isolated&#xa;MCP Server Host" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="110" y="255" width="128" height="70" as="geometry" />
        </mxCell>
        
        <!-- App Service Plan -->
        <mxCell id="app-service-plan" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/compute/App_Service_Plans.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="190" width="68" height="68" as="geometry" />
        </mxCell>
        
        <mxCell id="app-plan-label" value="App Service Plan&#xa;Flex Consumption&#xa;Linux" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="270" y="265" width="88" height="45" as="geometry" />
        </mxCell>
        
        <!-- API Management -->
        <mxCell id="apim" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/app_services/API_Management_Services.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="140" y="350" width="68" height="62" as="geometry" />
        </mxCell>
        
        <mxCell id="apim-label" value="API Management&#xa;apim-{token}&#xa;Basic v2 SKU&#xa;OAuth2 + Entra ID" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="110" y="415" width="128" height="45" as="geometry" />
        </mxCell>
        
        <!-- Communication Services Section -->
        <mxCell id="communication-section" value="Communication Services" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F0FFF0;strokeColor=#40E0D0;strokeWidth=2;fontStyle=1;fontSize=12;fontColor=#008B8B;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="520" y="150" width="380" height="200" as="geometry" />
        </mxCell>
        
        <!-- Azure Communication Services -->
        <mxCell id="acs" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/other/Azure_Communication_Services.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="550" y="190" width="68" height="68" as="geometry" />
        </mxCell>
        
        <mxCell id="acs-label" value="Communication Services&#xa;acs-{token}&#xa;Global Service&#xa;Data Location: US" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="530" y="265" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Email Communication Services -->
        <mxCell id="email-service" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/other/Email_Communication_Services.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="720" y="190" width="68" height="68" as="geometry" />
        </mxCell>
        
        <mxCell id="email-label" value="Email Services&#xa;ecs-{token}&#xa;Azure Managed Domain&#xa;DKIM/SPF/DMARC" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="700" y="265" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Identity & Security Section -->
        <mxCell id="identity-section" value="Identity &amp; Security" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF0F5;strokeColor=#FF69B4;strokeWidth=2;fontStyle=1;fontSize=12;fontColor=#C71585;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="930" y="150" width="360" height="200" as="geometry" />
        </mxCell>
        
        <!-- Managed Identity -->
        <mxCell id="managed-identity" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/identity/Managed_Identities.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="960" y="190" width="68" height="68" as="geometry" />
        </mxCell>
        
        <mxCell id="identity-label" value="User Assigned&#xa;Managed Identity&#xa;id-api-{token}&#xa;Communication Contributor" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="940" y="265" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Entra ID App -->
        <mxCell id="entra-app" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/identity/Azure_AD_App_Registrations.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1130" y="190" width="68" height="68" as="geometry" />
        </mxCell>
        
        <mxCell id="entra-label" value="Entra ID App&#xa;MCP-API-{token}&#xa;OAuth2 Client&#xa;APIM Authentication" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="1110" y="265" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Storage Section -->
        <mxCell id="storage-section" value="Storage &amp; Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5DC;strokeColor=#DAA520;strokeWidth=2;fontStyle=1;fontSize=12;fontColor=#B8860B;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="110" y="500" width="380" height="200" as="geometry" />
        </mxCell>
        
        <!-- Storage Account -->
        <mxCell id="storage" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/storage/Storage_Accounts.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="140" y="540" width="68" height="54" as="geometry" />
        </mxCell>
        
        <mxCell id="storage-label" value="Storage Account&#xa;st{token}&#xa;Function App Storage&#xa;Blob Container" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="120" y="600" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Blob Storage Detail -->
        <mxCell id="blob-container" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/storage/Blob_Services.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="540" width="68" height="54" as="geometry" />
        </mxCell>
        
        <mxCell id="blob-label" value="Blob Container&#xa;app-package-*&#xa;Function Deployment&#xa;TLS 1.2 Minimum" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="260" y="600" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Monitoring Section -->
        <mxCell id="monitoring-section" value="Monitoring &amp; Observability" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F0F8FF;strokeColor=#4169E1;strokeWidth=2;fontStyle=1;fontSize=12;fontColor=#191970;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="520" y="380" width="380" height="320" as="geometry" />
        </mxCell>
        
        <!-- Log Analytics -->
        <mxCell id="log-analytics" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/other/Log_Analytics_Workspaces.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="550" y="420" width="68" height="68" as="geometry" />
        </mxCell>
        
        <mxCell id="log-label" value="Log Analytics&#xa;log-{token}&#xa;30 Day Retention&#xa;Centralized Logging" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="530" y="495" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Application Insights -->
        <mxCell id="app-insights" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/other/Application_Insights.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="720" y="420" width="68" height="68" as="geometry" />
        </mxCell>
        
        <mxCell id="insights-label" value="Application Insights&#xa;appi-{token}&#xa;Performance Monitoring&#xa;Managed Identity Auth" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="700" y="495" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Health Endpoints -->
        <mxCell id="health-endpoints" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/other/Azure_Monitor.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="635" y="580" width="68" height="68" as="geometry" />
        </mxCell>
        
        <mxCell id="health-label" value="Health Endpoints&#xa;/api/healthz&#xa;/api/ready&#xa;Readiness Probes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="615" y="655" width="108" height="45" as="geometry" />
        </mxCell>
        
        <!-- Networking Section -->
        <mxCell id="networking-section" value="Networking (Optional VNet)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F0F0F0;strokeColor=#666666;strokeWidth=2;fontStyle=1;fontSize=12;fontColor=#333;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="930" y="380" width="360" height="320" as="geometry" />
        </mxCell>
        
        <!-- Virtual Network -->
        <mxCell id="vnet" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/networking/Virtual_Networks.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="960" y="420" width="68" height="54" as="geometry" />
        </mxCell>
        
        <mxCell id="vnet-label" value="Virtual Network&#xa;vnet-{token}&#xa;10.0.0.0/16&#xa;Private Networking" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="940" y="480" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Private Endpoint -->
        <mxCell id="private-endpoint" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/networking/Private_Endpoint.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1130" y="420" width="68" height="68" as="geometry" />
        </mxCell>
        
        <mxCell id="pe-label" value="Private Endpoint&#xa;Storage Account&#xa;Secure Access&#xa;No Public Access" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="1110" y="495" width="108" height="60" as="geometry" />
        </mxCell>
        
        <!-- Subnet Info -->
        <mxCell id="subnet-info" value="" style="image;aspect=fixed;perimeter=ellipsePerimeter;html=1;align=center;shadow=0;dashed=0;spacingTop=3;image=img/lib/azure2/networking/Subnets.svg;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1045" y="580" width="68" height="54" as="geometry" />
        </mxCell>
        
        <mxCell id="subnet-label" value="App Subnet&#xa;10.0.1.0/24&#xa;Function Integration&#xa;Private Access" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="1025" y="640" width="108" height="45" as="geometry" />
        </mxCell>
        
        <!-- Connection Lines -->
        <!-- Functions to ACS -->
        <mxCell id="func-to-acs" value="HTTPS&#xa;Email API" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0078D4;strokeWidth=2;fontSize=9;fontColor=#0078D4;" edge="1" parent="1" source="functions" target="acs">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- ACS to Email Service -->
        <mxCell id="acs-to-email" value="Linked Domain" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#40E0D0;strokeWidth=2;fontSize=9;fontColor=#40E0D0;" edge="1" parent="1" source="acs" target="email-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Functions to Identity -->
        <mxCell id="func-to-identity" value="Authentication" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF69B4;strokeWidth=2;fontSize=9;fontColor=#FF69B4;dashed=1;" edge="1" parent="1" source="functions" target="managed-identity">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="300" y="220" />
              <mxPoint x="300" y="120" />
              <mxPoint x="994" y="120" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Functions to Storage -->
        <mxCell id="func-to-storage" value="App Data&#xa;Deployment" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#DAA520;strokeWidth=2;fontSize=9;fontColor=#DAA520;" edge="1" parent="1" source="functions" target="storage">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Functions to Monitoring -->
        <mxCell id="func-to-monitoring" value="Telemetry" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4169E1;strokeWidth=2;fontSize=9;fontColor=#4169E1;" edge="1" parent="1" source="functions" target="app-insights">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="260" y="240" />
              <mxPoint x="400" y="240" />
              <mxPoint x="400" y="454" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Storage to Blob -->
        <mxCell id="storage-to-blob" value="Contains" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#DAA520;strokeWidth=1;fontSize=9;fontColor=#DAA520;" edge="1" parent="1" source="storage" target="blob-container">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- App Insights to Log Analytics -->
        <mxCell id="insights-to-log" value="Logs" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4169E1;strokeWidth=1;fontSize=9;fontColor=#4169E1;" edge="1" parent="1" source="app-insights" target="log-analytics">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- APIM to Functions -->
        <mxCell id="apim-to-func" value="Protected Access&#xa;OAuth2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF1493;strokeWidth=2;fontSize=9;fontColor=#FF1493;" edge="1" parent="1" source="apim" target="functions">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- VNet connections (optional) -->
        <mxCell id="vnet-to-func" value="VNet Integration" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=1;fontSize=9;fontColor=#666666;dashed=1;" edge="1" parent="1" source="vnet" target="functions">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="994" y="350" />
              <mxPoint x="500" y="350" />
              <mxPoint x="500" y="220" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="pe-to-storage" value="Private Access" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=1;fontSize=9;fontColor=#666666;dashed=1;" edge="1" parent="1" source="private-endpoint" target="storage">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1164" y="720" />
              <mxPoint x="450" y="720" />
              <mxPoint x="450" y="567" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Resource Configuration Details -->
        <mxCell id="config-box" value="Configuration Details" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFACD;strokeColor=#DDD700;strokeWidth=2;fontStyle=1;fontSize=12;fontColor=#8B8000;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="110" y="730" width="780" height="110" as="geometry" />
        </mxCell>
        
        <mxCell id="config-details" value="• Resource Naming: All resources use consistent naming with environment token&#xa;• Authentication: Managed Identity for all Azure service communications&#xa;• Networking: Optional VNet integration with private endpoints for enhanced security&#xa;• Monitoring: Comprehensive telemetry with Application Insights and Log Analytics&#xa;• Storage: TLS 1.2 minimum, shared key access disabled, managed identity authentication&#xa;• Communication Services: Global deployment with US data location, DKIM/SPF/DMARC support&#xa;• API Management: OAuth2 with Entra ID integration, Basic v2 SKU for production workloads" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#333;" vertex="1" parent="1">
          <mxGeometry x="130" y="760" width="740" height="75" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>